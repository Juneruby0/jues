<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cadastro</title>
  <link rel="stylesheet" href="cadastro.css" />
</head>
<body background="fundositehist.jpg">
  <div class="page">
    <form class="formCadastro">
      <h1>Cadastro</h1>

      <div class="form-row">
        <div class="form-group">
          <label for="nome">Nome Completo</label>
          <input type="text" id="nome"/>
        </div>
        <div class="form-group">
          <label for="uf">UF*</label>
          <select id="uf">
            <option>Selecione seu UF*</option>
            <option>Acre (AC)</option>
            <option>Alagoas (AL)</option>
            <option>Amapá (AP)</option>
            <option>Amazonas (AM)</option>
            <option>Bahia (BA)</option>
            <option>Ceará (CE)</option>
            <option>Distrito Federal (DF)</option>
            <option>Espirito Santo (ES)</option>
            <option>Goiás (GO)</option>
            <option>Maranhão (MA)</option>
            <option>Mato Grosso (MT)</option>
            <option>Mato Grosso do Sul (MS)</option>
            <option>Minas Geráis (MG)</option>
            <option>Pará (PA)</option>
            <option>Paraiba (PB)</option>
            <option>Paraná (PR)</option>
            <option>Pernambuco (PE)</option>
            <option>Piauí (PI)</option>
            <option>Rio de Janeiro (RJ)</option>
            <option>Rio Grande do Norte (RN)</option>
            <option>Rio Grande do Sul (RS)</option>
            <option>Rondônia (RO)</option>
            <option>Roraima (RR)</option>
            <option>Santa Catarina (SC)</option>
            <option>São Paulo (SP)</option>
            <option>Sergipe (SE)</option>
            <option>Tocantins (TO)</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="cpf">CPF</label>
          <input type="text" id="cpf" placeholder="000.000.000-00" maxlength="14"/>
        </div>
        <div class="form-group">
          <label for="cep">CEP</label>
          <input type="text" id="cep" placeholder="00000-000" maxlength="9"/>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="email">E-mail</label>
          <input type="email" id="email"/>
        </div>
        <div class="form-group">
          <label for="cidade">Cidade</label>
          <input type="text" id="cidade"/>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="senha">Senha</label>
          <input type="password" id="senha"/>
        </div>
        <div class="form-group">
          <label for="rua">Rua</label>
          <input type="text" id="rua"/>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="confirmar">Confirmar senha</label>
          <input type="password" id="confirmar" />
        </div>
        <div class="form-group">
          <label for="num">Nº</label>
          <input type="text" id="num"/>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group" style="flex: 1">
          <label for="data">Data de nascimento</label>
          <input type="date" id="data"/>
        </div>
        <div class="form-group">
          <label for="bairro">Bairro</label>
          <input type="text" id="bairro" />
        </div>
      </div>

      <a href="login.html">Já é cadastrado? Faça o login</a>
      <button type="submit" class="btn">Cadastrar</button>

       <!-- Aqui vai aparecer o erro -->
    <p id="erro" style="color: red; display: none;">Preencha todos os campos!</p>

    </form>
  </div>

  <script>

  //CPF
const cpfInput = document.getElementById('cpf');
cpfInput.addEventListener('input', () => {
    let cpf = cpfInput.value.replace(/\D/g, '');
    if (cpf.length > 3 && cpf.length <= 6) {
        cpf = cpf.slice(0, 3) + '.' + cpf.slice(3);
    } else if (cpf.length > 6 && cpf.length <= 9) {
        cpf = cpf.slice(0, 3) + '.' + cpf.slice(3, 6) + '.' + cpf.slice(6);
    } else if (cpf.length > 9) {
        cpf = cpf.slice(0, 3) + '.' + cpf.slice(3, 6) + '.' + cpf.slice(6, 9) + '-' + cpf.slice(9, 11);
    }
    cpfInput.value = cpf;
});

//CEP
const cepInput = document.getElementById('cep');
cepInput.addEventListener('input', () => {
    let cep = cepInput.value.replace(/\D/g, '');
    if (cep.length > 5) {
        cep = cep.substring(0, 5) + '-' + cep.substring(5, 8);
    }
    cepInput.value = cep;
});

// Preencher endereço automaticamente via API do ViaCEP
cepInput.addEventListener('blur', async () => {
    const cep = cepInput.value.replace(/\D/g, '');
    if (cep.length !== 8) {
        alert('CEP inválido. Deve conter 8 dígitos.');
        return;
    }

    try {
        const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
        const data = await response.json();

        if (data.erro) {
            alert('CEP não encontrado.');
            return;
        }

       document.getElementById('rua').value = data.logradouro || '';
       document.getElementById('bairro').value = data.bairro || '';
       document.getElementById('cidade').value = data.localidade || '';

    } catch (error) {
        alert('Erro ao buscar endereço. Tente novamente.');
        console.error('Erro:', error);
    }
});

// Validação de CPF
function validarCPF(cpf) {
    cpf = cpf.replace(/\D/g, '');
    if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;

    let soma = 0;
    for (let i = 0; i < 9; i++) soma += parseInt(cpf[i]) * (10 - i);
    let dig1 = 11 - (soma % 11);
    dig1 = dig1 > 9 ? 0 : dig1;
    if (parseInt(cpf[9]) !== dig1) return false;

    soma = 0;
    for (let i = 0; i < 10; i++) soma += parseInt(cpf[i]) * (11 - i);
    let dig2 = 11 - (soma % 11);
    dig2 = dig2 > 9 ? 0 : dig2;
    return parseInt(cpf[10]) === dig2;
}

// Validação do formulário completo
document.querySelector('.formCadastro').addEventListener('submit', async function (event) {
    event.preventDefault();

    const nome = document.getElementById('nome').value.trim();
    const cpf = document.getElementById('cpf').value.trim();
    const email = document.getElementById('email').value.trim();
    const senha = document.getElementById('senha').value;
    const confirmar = document.getElementById('confirmar').value;
    const data = document.getElementById('data').value;
    const uf = document.getElementById('uf').value;
    const cep = document.getElementById('cep').value.trim();
    const rua = document.getElementById('rua').value.trim();
    const num = document.getElementById('num').value.trim();
    const bairro = document.getElementById('bairro').value.trim();
    const cidade = document.getElementById('cidade').value.trim();
    const erro = document.getElementById("erro"); 

    if (!nome || !cpf || !email || !senha || !confirmar || !data || !uf || !cep || !rua || !num || !bairro || !cidade) {
        erro.style.display = "block";
        return;
    } else {
        erro.style.display = "none";
    }

    const cpfRegex = /^\d{3}\.\d{3}\.\d{3}-\d{2}$/;
    if (!cpfRegex.test(cpf)) {
        alert('CPF inválido. Use o formato 000.000.000-00');
        return;
    }

    if (!validarCPF(cpf)) {
        alert('CPF inválido! Número incorreto.');
        return;
    }

    const cepRegex = /^\d{5}-\d{3}$/;
    if (!cepRegex.test(cep)) {
        alert('CEP inválido. Use o formato 00000-000');
        return;
    }

    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        alert('E-mail inválido.');
        return;
    }

    if (senha !== confirmar) {
        alert('As senhas não coincidem.');
        return;
    }

    alert('Cadastro realizado com sucesso!');
    // Aqui poderia enviar os dados para um backend ou redirecionar
    window.location.href = "login.html";

});
</script>

</body>
</html>
